---
title: "Unity in diversity: Children from 17 communities process gaze in similar ways"
subtitle: "Supplementary material"
author: "..."
output: 
  bookdown::pdf_document2:
    toc: yes 
    number_sections: false    
  bookdown::html_document2:
    toc: yes
    toc_float: true
    fig_caption: yes
    #code_folding: hide
    number_sections: false
bibliography: library.bib
#csl: pnas.csl
header-includes:
  \usepackage{caption}
  \renewcommand{\figurename}{Supplementary Figure}
  \renewcommand{\tablename}{Supplementary Table}
---

```{r, echo=FALSE, message=F}
library(tidyverse)
library(ggpubr)
library(ggthemes)
library(tidyboot)
library(maps)
library(brms)
library(cowplot)
library(ggridges)
library(papaja)

estimate_mode <- function(s) {
  d <- density(s)
  return(d$x[which.max(d$y)])
}


hdi_upper<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","upper"])
}

hdi_lower<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","lower"])
}

knitr::opts_chunk$set(echo=F, warning=FALSE, message=FALSE, size="small")

```

```{r}
data <- read_csv("../data/gafo-cc-clean-data.csv")%>%
  mutate(continent = ifelse(
    community %in% c("leipzig", "plymouth"), "Europe", 
    ifelse(
      community %in% c("akure", "hai||om", "khwe", "chimfunshi", "bandongo", "bayaka", "windhoek", "uganda"), "Africa",
      ifelse(community %in% c("stanford", "mexico", "buenos_aires"), "America",
             ifelse(community %in% c("india", "beijing", "turkey"), "Asia", "Oceania"))
    )
  ))%>%
  mutate(continent = factor(continent, levels = c("America", "Africa", "Europe", "Asia", "Oceania"), ordered = T))%>%
  mutate(community = recode(community,
                            akure = "Akure (Nigeria)",
                            leipzig = "Leipzig (Germany)",
                            `hai||om` = "Hai||om (Namibia)",
                            khwe = "Khwe (Namibia)",
                            windhoek = "Windhoek (Namibia)",
                            stanford = "Stanford (USA)",
                            chimfunshi = "Chimfunshi (Sambia)",
                            mexico = "Ocuilan (Mexico)",
                            plymouth = "Plymouth (UK)",
                            beijing = "Beijing (China)", 
                            india = "Pune (India)",
                            buenos_aires = "Buenos Aires (Argentina)",
                            auckland = "Auckland (New Zealand)",
                            turkey = "Malatya (Turkey)",
                            bandongo = "Bandongo (Rep. Congo)",
                            bayaka = "BaYaka (Rep. Congo)", 
                            uganda = "Nyabyeya (Uganda)"))
```


# Overview

in the section [site descriptions](#site-descriptions)

# Participants

```{r demtable, echo=F}
demtab <- data %>%
  separate(community, into = c("community", "country"), sep = " \\(")%>%
  mutate(country = str_remove(country, "\\("),
         country = str_remove(country, "\\)"))%>%
  distinct(subjid, .keep_all = T)%>%
  group_by(community, country, continent)%>%
  summarise(N = n_distinct(subjid), 
            m = sum(sex == "m", na.rm = T), 
            mean_age = mean(ageinyears),
            min_age = min(ageinyears), 
            max_age = max(ageinyears))%>%
  mutate_if(is.numeric, format, digits = 2, nsmall = 2)%>%
  mutate(age = paste(mean_age, " (", min_age, " - ", max_age, ")"))%>%
  select(-c(mean_age, min_age, max_age))%>%
  arrange(continent)


knitr::kable(demtab,
             col.names = c("Community", "Country", "Continent", "N", "Sex (male)", "Age (range)"),
             caption = "Participant demographics.", 
             #ote = "Column age shows mean and range in paranthesis.", digits = 2, align = "l"
             )
```

A total of `r sum(as.numeric(demtab$N))` children between `r round(min(data$ageinyears), 2)` and `r round(max(data$ageinyears), 2)` provided data for the study. Children lived in `r n_distinct(data$community)` different communities, located in `r n_distinct(data$country)` different countries. Table \@ref(tab:demtable) gives the sample size per community together with some basic demographic information. Additional children were recruited but did not contribute data to the study. The recruitment strategy varied from community to community and we therefore cannot provide detailed information about the number of children that were excluded. All children who contributed at least five valid data points were included in the final sample. We did not exclude any participants for performance reasons. A detailed description of each site and the way children were recruited can be found below.

```{r}
data%>%
  group_by(community,continent)%>%
  distinct(subjid, .keep_all = T)%>%
  mutate(dens = approxfun(density(ageinyears))(ageinyears))%>%
  ggplot(aes(y = community, x = ageinyears))+
  facet_grid(continent~., scales = "free", space = "free_y")+
  geom_density_ridges(col = "white")+
  #geom_point(alpha = .1)+
  theme_few()
```

## Site descriptions

### Chimfunshi (Sambia) - Location 

### Hai||om (Namibia) - Ethnic group

### Khwe (Namibia) - Ethnic group

### Windhoek (Namibia) - Location 

### Leipzig (Germany) - Location 

### Akure (Nigeria) - Location 

### Plymouth (UK) - Location 

### Stanford (USA) - Location 

### Ocuilan (Mexico) - Location 

### Beijing (China) - Location 

### Buenos Aires (Argentina) - Location 

### Pune (India) - Location 

### Auckland (New Zealand) - Location 

### Malatya (Turkey) - Location 

### Bandongo (Rep. Congo) - Ethnic group 

### Bayaka (Rep. Congo) - Ethnic group

### Nyabyeya (Uganda) - Location   

# Method

We adapted the task developed by Prein and colleagues [@prein2023tango]. We refer to the original publication for a detailed description of its development, implementation and psychometric evaluation (in Germany). Below give an overview and focus on the cross-cultural adaptation of the task. The task itself, including all the versions used in the study, can be accessed via the following website: https://ccp-odc.eva.mpg.de/tango-cc/

## Design

## Setup and Procedure

The task was implemented as a browser-based interactive picture book. Participants saw animated agents on a touch screen device, listened to pre-recorded audio instructions and responded by touching the screen. In all communities, a research assistant, fluent in the local language(s), guided the child through the task. 

Figure X shows a screenshot from the task. The task was introduced verbally by the assistant as the balloon game in which the participant would play with other children to find a balloon. On each trial, participants saw an agent located in a window in the center of the screen. A balloon fell down from its starting position just below the agent. The agent's gaze followed the trajectory of the balloon. That is, the pupils and the iris were programmed to align with the center of the balloon. Once the balloon had landed on the ground, the agent was instructed to locate it, that is, to touch the location on the screen where they thought the balloon was. On each trial, we recorded the exact x-coordinate of the participant's touch.

There were two types of familiarization trials. In fam1 trials, the balloon fell down and landed in plain sight. Participants simply had to touch the visible balloon. In fam2 trials, the trajectory of the balloon was visible but it landed behind a small barrier (usually a hedge - see Figure XXB). Thus, participants needed to touch the hedge where they saw the balloon land. Next came test trials. Here, the barrier moved up and covered the balloons trajectory. That is, participants only saw the agents eyes move, but not the balloon. They had to infer the location of the balloon based on the agent's gaze direction. During fam1, fam2 and the first test trial, children heard voice overs commenting what happened on the screen. Critically, the agent was described as wanting to help the child and to always look at the balloon (see section [script](#appendix-script) for the English wording). 

Children completed one fam1 trial, two fam2 trials and 16 test trials. We excluded the first test trial from the analysis because of the voice-over. Thus, 15 test trials were used in the analysis below. 

Each child saw eight different agents, four male, four female. The agent changed from trial to trail, with alternating genders. A coin toss before the first trial decided whether the first agent was male or female. The order in which agents were shown was randomized with the constraint that all agents had to be shown once until an agent was shown again. The color of the balloon also changed from trial to trial in a random order, also with the constraint that all colors appeared once before any one was repeated.

The location (x-coordinate) where the balloon landed was determined in the following way: The screen was divided in ten equally sized bins. On each trial, one of the bins was randomly selected and the exact x-coordinate was randomly chosen within that bin. Constraints were that the balloon landed in each bin equally often and the same bin appeared no more than twice in a row. 

All children were tested with a touch screen device with a size between 11 and 13 inch equipped with a webcam. The data was either stored locally or sent to a server. In addition to the behavioral data, we stored the webcam recording of the session for verification purposes.  

## Culture-specific adaptations

The following components of the task were adapted to each cultural settings: voice-overs, agents, background. The voice overs were originally formulated in British English and German (see section [script](#script)). For each setting, they were first translated/adapted to the local language. In some cases (BaYaka and Bandongo) this was done by first translating them to French. The translations were done by native or near-native speakers. They were not exact translations of the original text but were adapted so that children from the respective community would understand them. For example, the word "hedge" in the British English version  was changed to "bush" for the Nigerian English version to adjust for how children in the respective community would refer to the thing they saw. The content of each utterance was comparable across languages.

The agents were drawn for each cultural setting in close collaboration with local researchers and/or research assistants. They were meant to show young adults and represent the diversity in appearance prevalent in the local population. See section [agents](#agents)) for all faces used in the study. 



## Questionnaire

# Analysis

# Appendix

## Voice-over script 

### Welcome (before the start of the task)

Hello! Great that you’re here. We’ll now play a balloon game. Can you see the children in the picture over there? We want to play together with the children using the balloon. We’ll now talk you through exactly what will happen.

### Fam 1

Look, a girl/boy is standing in the window. And can you see the balloon over there? The balloon always falls down and lands on the ground. And you have to find it! The girl/boy helps you and always looks at the balloon.

[balloon falls down]

Where is the balloon? Touch the balloon!

### Fam 2

Perfect, that was great! Now, we’ll continue playing. Can you see the girl/boy and the balloon again? The balloon will fall down again. This time, it will fall behind a hedge. And you have to find it! The girl/boy helps you and looks at the balloon.

[balloon falls down]

Where is the balloon? On the hedge, touch where the balloon is.

### Test

Nice, good job! Now, we’ll continue playing. There is the balloon, the girl/boy and the hedge. The hedge is growing a bit now.

The balloon is behind the hedge now. You can’t see it - but the girl/boy can! The balloon falls to the ground and you have to find it. Remember - the girl/boy always looks at the balloon!

### Goodbye (after the last test trial)

The children are super happy after playing. Thanks a lot for your help! See you soon and goodbye!

## Agents

Figure \@ref(fig:figagents) shows the agents that were used in the study. Some agents were used in multiple cultural settings. All agents had the same underlying eye-geometry (size of the pupil and the iris) and only differed in superficial features. 

```{r figagents, include = T, fig.align = "center", fig.cap = "Agents used in the task. Some agents were used for multiple cultural settings", out.width="100%"}
knitr::include_graphics("../visuals/agents.png")
```

\newpage

# References

