---
title: "model"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(coda)
library(jsonlite)
library(ggthemes)
library(ggpubr)
library(data.table)
library(truncnorm)
library(matrixStats)
library(tidyboot)

estimate_mode <- function(s) {
  d <- density(s)
  return(d$x[which.max(d$y)])
}

hdi_upper<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","upper"])
}

hdi_lower<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","lower"])
}
```

# Data

```{r}
data <- read_csv("../data/gafo-cc-clean-data.csv")

```

# Model comparison

## Hai||om

```{r, message=FALSE, warning=F}
haillom_model_comparison <- rbindlist(
  list(
     fread("../model/output/haillom_model_comparison_chain1.csv"),
     fread("../model/output/haillom_model_comparison_chain1.csv"),
     fread("../model/output/haillom_model_comparison_chain1.csv"),
     fread("../model/output/haillom_model_comparison_chain1.csv"),
     fread("../model/output/haillom_model_comparison_chain1.csv"),
     fread("../model/output/haillom_model_comparison_chain1.csv")
    ), use.names=TRUE)%>%saveRDS("../models/output/haillom_model_comparison.rds")%>%
  group_by(chain, iteration, model)%>%
  summarise(like = sum(loglike))%>%
  mutate(community = "hai||om")

 haillom_model_comparison <- readRDS("../model/output/haillom_model_comparison.rds")
```

```{r}
haillom_model_comparison%>%
  group_by(community, model,chain)%>%
  summarise(margllh = logSumExp(like))%>%
  pivot_wider(names_from = model, values_from = margllh)
```


# Summary

```{r}
bind_rows(
  haillom_model_comparison
) %>%
  group_by(community, model)%>%
  summarise(margllh = logSumExp(like))%>%
  pivot_wider(names_from = model, values_from = margllh)%>%
  summarise(bf_inf_center = inf - center, 
            bf_inf_guess = inf - guess)

```

```{r}
bind_rows(
  haillom_model_comparison
)%>%
  ggplot(aes(x = like))+
  geom_histogram(alpha = .5, aes(fill = model), col = "black")+
  facet_wrap(~community, scales = "free")+
  scale_fill_colorblind()+
  xlim(-8000, -5000)+
  theme_bw()
```

