---
title: "Gafo-cc visuals"
output: html_document
---

```{r}
library(tidyverse)
library(ggpubr)
library(ggthemes)
library(tidyboot)
```


```{r}
data <- read_csv("../data/gafo-cc-clean-data.csv")%>%
  mutate(community = recode(community,
                            akure = "akure (nigeria)",
                            leipzig = "leipzig (germany)",
                            `hai||om` = "hai||om (namibia)",
                            khwe = "khwe (namibia)",
                            windhoek = "windhoek (namibia)",
                            stanford = "stanford (usa)",
                            chimfunshi = "chimfunshi (sambia)",
                            mexico = "ocuilan (mexico)",
                            plymouth = "plymouth (uk)",
                            beijing = "beijing (china)"))
```

```{r}
data%>%
  group_by(community)%>%
  summarise(n= n_distinct(subjid))

data%>%
  summarise(n= n_distinct(subjid))

data%>%
  group_by(community, age_group)%>%
  summarise(n = n_distinct(subjid))
```



```{r}
data%>%
  #filter(community != "chimfunshi (sambia)")%>%
  group_by(community,subjid, ageinyears)%>%
  summarise(impr = mean(abs(clickdistfromtargetcenterx)))%>%
  ggplot(aes(x = ageinyears, y = impr, col = community))+
  geom_point(alpha = .25)+
  geom_smooth(method = "lm")+
  scale_color_ptol(name = "Community")+
  ylim(0,1000)+
  #facet_wrap(~community)+
  labs(x = "Age (in years)", y ="Imprecision (average click distance from target)")+
  scale_x_continuous(breaks = 2:8)+
  theme_minimal()+
  theme(legend.position = "right")
  
```
```{r}
ggsave("../visuals/dev_site.png", width = 8, height = 6, bg = "white")
```


```{r}
data%>%
  group_by(targetcentralityx)%>%
  mutate(chance_upper = (targetcentralityx + 960)/2,
         chance_lower = -((targetcentralityx + 960)/2),
         center_lower = -targetcentralityx,
         center_upper = targetcentralityx)%>%
  ggplot(aes(x = targetcentralityx, y = clickdistfromtargetcenterx, col = community))+
  geom_hline(yintercept = 0, lty = 3, alpha = 0.75)+
  geom_line(aes(x = targetcentralityx, y = center_upper), lty = 1, alpha = .75, col = "firebrick")+
  geom_line(aes(x = targetcentralityx, y = center_lower), lty = 1, alpha = .75, col = "firebrick")+
  geom_line(aes(x = targetcentralityx, y = chance_upper), lty = 3, alpha = .75, col = "firebrick")+
  geom_line(aes(x = targetcentralityx, y = chance_lower), lty = 3, alpha = .75, col = "firebrick")+
  geom_point(pch = 1, alpha = 0.5)+
  scale_color_colorblind()+
  #ylim(-1500,1500)+
  theme_minimal()

```

```{r}
ggsave("../visuals/dev_site.png", width = 8, height = 6, bg = "white")
```

```{r}
data%>%
  distinct(targetposition, targetcentralityx)%>%
  expand_grid(random_click = runif(10000, min = 0, max = 1920))%>%
  mutate(dist = abs(targetcentralityx - random_click))%>%
  group_by(targetposition)%>%
  summarise(random = mean(dist))



```



```{r}
ptp<- data%>%
  #filter(community != "chimfunshi (sambia)")%>%
  mutate(targetposition = factor(targetposition, levels = c(1:10)))%>%
  #group_by(community, targetposition, age_group)%>%
  group_by(community, targetposition)%>%
  tidyboot_mean(col= abs(clickdistfromtargetcenterx))


alt1 <- data%>%
  mutate(targetposition = factor(targetposition, levels = c(1:10)))%>%
  group_by(targetposition)%>%
  summarise(center = mean(targetcentralityx))%>%
  mutate(group = "group")%>%
  ungroup()

alt2 <- data%>%
  distinct(targetposition, targetcentralityx)%>%
  expand_grid(random_click = runif(10000, min = 0, max = 1920))%>%
  mutate(dist = abs(targetcentralityx - random_click))%>%
  group_by(targetposition)%>%
  summarise(random = mean(dist))%>%
  mutate(group = "group")

ggplot(ptp, aes(x = targetposition, y = mean, col = community))+
  geom_line(data = alt1, aes(x = targetposition, y = center, group = group), lty = 3, alpha = 0.75, col = "black")+
  geom_line(data = alt2, aes(x = targetposition, y = random, group = group), lty = 3, alpha = 0.75,  col = "black")+
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper),pch = 1, alpha = 0.75, position = position_dodge(width = .5))+
  labs(x = "Target position (binned)", y = "Imprecision (average click distance from target)")+
  scale_color_ptol(name = "Community")+
  #facet_grid(~age_group)+
  ylim(0,1000)+
  theme_minimal()
```

```{r}
ggsave("../visuals/target_position_site.png", width = 8, height = 6, bg = "white")
```

```{r}
pscreen1 <- data%>%
  group_by(community)%>%
  mutate(clickdistfromtargetcenterx = scale(abs(clickdistfromtargetcenterx)))%>%
  mutate(screen = factor(screen),
         touchscreen = factor(touchscreen))%>%
  pivot_longer(cols = c(screen, touchscreen), names_to = "predictor", values_to = "value")%>%
  group_by(subjid, predictor, value)%>%
  summarise(mean= mean(clickdistfromtargetcenterx))

pscreen2 <- data%>%
  group_by(community)%>%
  mutate(clickdistfromtargetcenterx = scale(abs(clickdistfromtargetcenterx)))%>%
  mutate(screen = factor(screen),
         touchscreen = factor(touchscreen))%>%
  pivot_longer(cols = c(screen, touchscreen), names_to = "predictor", values_to = "value")%>%
  group_by(predictor, value)%>%
  tidyboot_mean(col= clickdistfromtargetcenterx)


ggplot(pscreen2%>%filter(!is.na(value)), aes(x = value, y = mean))+
  geom_jitter(data = pscreen1%>%filter(!is.na(value)), aes(x = value, y = mean), pch = 1, alpha = .25, height = 0)+
  geom_pointrange(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.75, position = position_dodge(width = .5), col = "firebrick")+
  facet_grid(~predictor, scales = "free_x")+
  scale_x_discrete(labels = c("no", "yes"))+
  labs(y = "Imprecision (scaled within community)", x = "Predictor value")+
  scale_color_colorblind()+
  
  #ylim(0,1000)+
  theme_bw()
```

```{r}
ggsave("../visuals/pred_screen.png", width = 8, height = 6, bg = "white")
```

```{r}
pred <- data%>%
  group_by(community)%>%
  mutate(clickdistfromtargetcenterx = scale(abs(clickdistfromtargetcenterx)), 
         household = scale(household), 
         children = scale(children),
         younger_children = scale(younger_children))%>%
  group_by(subjid,community, household, children, younger_children)%>%
  summarise(mean= mean(clickdistfromtargetcenterx))%>%
  pivot_longer(cols = c(household, children, younger_children), names_to = "predictor", values_to = "value")%>%
  group_by(predictor)%>%
  mutate(value = scale(value))
  


ggplot(pred, aes(x = value, y = mean))+
  geom_point(pch = 1)+
  geom_smooth(method = "glm")+
  facet_grid(~predictor, scales = "free_x")+
  stat_cor()+
  scale_color_colorblind()+
  labs(y = "Imprecision (scaled within community)", x = "Predictor value (scaled within community)")+
  #ylim(0,1000)+
  theme_bw()
```


```{r}
ggsave("../visuals/pred_household.png", width = 12, height = 6, bg = "white")
```


